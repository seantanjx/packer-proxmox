# Generated by Anaconda 34.25.3.8
# Generated by pykickstart v3.32
#version=RHEL9
eula --agreed

repo --name="AppStream" --baseurl=file:///run/install/repo/AppStream

%addon com_redhat_kdump --enable --reserve-mb='auto'
%end

# Keyboard layouts
keyboard --xlayouts='us'
# System language
lang en_SG.UTF-8

# Network information
network --bootproto=dhcp --device=ens18 --ipv6=auto --activate

# Use CDROM installation media
cdrom
text

%packages
@^minimal-environment
openssh-server
curl
qemu-guest-agent
sudo
# allow for ansible
python3
python3-pip

# unnecessary firmware
-aic94xx-firmware
-atmel-firmware
-b43-openfwwf
-bfa-firmware
-ipw2100-firmware
-ipw2200-firmware
-ivtv-firmware
-iwl100-firmware
-iwl1000-firmware
-iwl3945-firmware
-iwl4965-firmware
-iwl5000-firmware
-iwl5150-firmware
-iwl6000-firmware
-iwl6000g2a-firmware
-iwl6050-firmware
-libertas-usb8388-firmware
-ql2100-firmware
-ql2200-firmware
-ql23xx-firmware
-ql2400-firmware
-ql2500-firmware
-rt61pci-firmware
-rt73usb-firmware
-xorg-x11-drv-ati-firmware
-zd1211-firmware
%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.6.0
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --none --initlabel

# System timezone
timezone Asia/Singapore --utc

# Root password
rootpw test
user --groups=wheel --name=packer --password=test --gecos="packer"

%post --log=/root/kickstart-post.log
# Passwordless sudo for the user 'packer'
echo "packer ALL=(ALL) NOPASSWD: ALL" >>/etc/sudoers.d/packer
chmod 0440 /etc/sudoers.d/packer
cp /etc/sudoers /etc/sudoers.orig

dnf update -y
dnf clean all

# sudo systemctl enable sshd
# sudo systemctl start sshd
# firewall-cmd --zone=public --permanent --add-service=ssh

# pip install ansible

# git clone https://github.com/seantanjx/ansible-packer.git ~/
# cd ~/ansible-packer
# ansible-playbook playbook.yml
# rm -rf ~/ansible-packer
%end
