# Generated by Anaconda 34.25.3.8
# Generated by pykickstart v3.32
#version=RHEL9
# Use graphical install
graphical
repo --name="minimal" --baseurl=file:///run/install/sources/mount-0000-cdrom/minimal

%addon com_redhat_kdump --enable --reserve-mb='auto'
%end

# Keyboard layouts
keyboard --xlayouts='us'
# System language
lang en_SG.UTF-8

# Network information
network --bootproto=dhcp --device=ens18 --ipv6=auto --activate

# Use CDROM installation media
cdrom

%packages
@^minimal-environment
@base
@core
qemu-guest-agent
sudo
%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.6.0
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --none --initlabel

# System timezone
timezone Asia/Singapore --utc

# Root password
rootpw --iscrypted $6$HidLW0mxIhNLfTKH$fDOsk8a2O4xsJaIiG2BLzqRBYjqqybuPMXT01bm8n5EfUnXRrwLv1DeMK8x35CQbbuFiogrH2gRBa04HwfPbB/
user --groups=wheel --name=packer --password=test --gecos="packer"

%post
# Passwordless sudo for the user 'packer'
echo "packer ALL=(ALL) NOPASSWD: ALL" >>/mnt/sysimage/etc/sudoers.d/packer

# dnf -y upgrade
# dnf install -y python3-pip openssh-server git

# sudo systemctl enable sshd
# sudo systemctl start sshd
# firewall-cmd --zone=public --permanent --add-service=ssh

# pip install ansible

# git clone https://github.com/seantanjx/ansible-packer.git ~/
# cd ~/ansible-packer
# ansible-playbook playbook.yml
# rm -rf ~/ansible-packer
reboot
%end
